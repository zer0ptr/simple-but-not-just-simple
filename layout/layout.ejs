<!DOCTYPE html>
<html lang="<%= config.language || 'en' %>">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <% if (page.title) { %>
            <%= page.title %> | <%= config.title %>
        <% } else { %>
            <%= config.title %>
            <% if (config.subtitle) { %> - <%= config.subtitle %><% } %>
        <% } %>
    </title>
    
    <!-- Meta tags -->
    <meta name="description" content="<%= page.description || config.description || '' %>">
    <meta name="author" content="<%= config.author || '' %>">
    
    <!-- 关键CSS内联 -->
    <style>
        /* CSS变量系统 */
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --text-muted: #888888;
            --border-color: #eeeeee;
            --border-light: #f5f5f5;
            --link-color: #007BFF;
            --link-hover: #0056b3;
            --footer-bg: #ffffff;
            --footer-border: #eeeeee;
            --button-bg: #f5f5f5;
            --button-active: #007acc;
            --button-text: #333333;
            --button-active-text: #ffffff;
        }
        
        /* 关键渲染路径CSS */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6; color: var(--text-color); background-color: var(--bg-color); font-size: 17px; overflow-x: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .container { max-width: 650px; margin: 0 auto; padding: 0 15px; }
        .loading-indicator {
            position: fixed; top: 0; left: 0; width: 100%; height: 3px;
            background: linear-gradient(90deg, #007acc, #4fc3f7);
            transform: translateX(-100%); transition: transform 0.3s ease; z-index: 9999;
        }
        .loading-indicator.active { animation: loadingProgress 1s ease-in-out infinite; }
        @keyframes loadingProgress {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(0%); }
            100% { transform: translateX(100%); }
        }
    </style>
    
    <!-- 异步加载完整CSS -->
    <link rel="preload" href="<%- url_for('css/style.css') %>" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="<%- url_for('css/style.css') %>"></noscript>
    
    <!-- CSS加载polyfill -->
    <script>
        // 确保CSS异步加载在所有浏览器中正常工作
        !function(e){"use strict";var t=function(t,n,r){function o(e){return i.body?e():void setTimeout(function(){o(e)})}function a(){d.addEventListener&&d.removeEventListener("load",a),d.media=r||"all"}var i=e.document,d=i.createElement("link");if(n)d.id=n;d.rel="stylesheet",d.href=t,d.media="only x",o(function(){i.head.appendChild(d)}),setTimeout(a);return d};e.loadCSS=t}(this);
    </script>
    
    <!-- 预加载关键资源 -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <!-- 按需加载Highlight.js CSS -->
    <% if (is_post() && page.content && page.content.includes('<code')) { %>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <% } %>
    
    <!-- 按需加载MathJax -->
    <% if (is_post() && page.content && (page.content.includes('$') || page.content.includes('\\('))) { %>
        <script>
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$'], ['\\[', '\\]']],
                    processEscapes: true,
                    processEnvironments: true
                },
                options: {
                    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                }
            };
        </script>
        <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <% } %>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- 预加载JavaScript -->
    <link rel="preload" href="<%- url_for('js/search.js') %>" as="script">
    <link rel="preload" href="<%- url_for('js/script.js') %>" as="script">
</head>
<body>
    <!-- 加载指示器 -->
    <div class="loading-indicator" id="loadingIndicator"></div>
    <!-- Top Navigation Bar -->
    <% if (theme.menu) { %>
    <nav class="top-navigation">
        <div class="container">
            <div class="nav-brand">
                <a href="<%= url_for('/') %>" class="nav-brand-link">
                    <%= theme.site?.title || config.title %>
                </a>
            </div>
            <ul class="top-nav-list">
                <% for (let name in theme.menu) { %>
                    <li class="top-nav-item">
                        <a href="<%= url_for(theme.menu[name]) %>" class="top-nav-link">
                            <%= name %>
                        </a>
                    </li>
                <% } %>
                <li class="top-nav-item">
                    <a href="https://github.com" class="top-nav-link" target="_blank">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                        </svg>
                    </a>
                </li>
                <li class="top-nav-item">
                    <a href="#" class="top-nav-link search-toggle">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <% } %>
    
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="site-title">
                    <a href="<%= url_for('/') %>">
                        <%= theme.site?.title || config.title %>
                    </a>
                </h1>
                <% if (theme.site?.subtitle || config.subtitle) { %>
                    <p class="site-subtitle">
                        <%= theme.site?.subtitle || config.subtitle %>
                    </p>
                <% } %>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content page-transition" id="mainContent">
            <%- body %>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-columns">
                    <div class="footer-column">
                        <h3 class="footer-column-title">Blog</h3>
                        <ul class="footer-links">
                            <li><a href="<%= url_for('/') %>" class="footer-link">Blog</a></li>
                            <li><a href="<%= url_for('/archives') %>" class="footer-link">Archives</a></li>
                            <li><a href="<%= url_for('/tags') %>" class="footer-link">Tags</a></li>
                            <li><a href="<%= url_for('/categories') %>" class="footer-link">Categories</a></li>
                            <li><a href="<%= url_for('/search') %>" class="footer-link">Search</a></li>
                            <li><a href="<%= url_for('/friends') %>" class="footer-link">Friends</a></li>
                            <li><a href="<%= url_for('/something') %>" class="footer-link">Something</a></li>
                            <li><a href="<%= url_for('/about') %>" class="footer-link">About</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h3 class="footer-column-title">Me</h3>
                        <ul class="footer-links">
                            <li><a href="https://github.com" target="_blank" rel="noopener" class="footer-link">GitHub</a></li>
                            <li><a href="https://twitter.com" target="_blank" rel="noopener" class="footer-link">Twitter</a></li>
                            <li><a href="https://bilibili.com" target="_blank" rel="noopener" class="footer-link">Bilibili</a></li>
                            <li><a href="mailto:example@email.com" class="footer-link">Email</a></li>
                        </ul>
                    </div>
                </div>
                <div class="footer-bottom">
                    <div class="footer-info">
                        <p class="footer-copyright">&copy; <%= date(new Date(), 'YYYY') %> <%= config.author || config.title %></p>
                        <p class="footer-powered">Powered by <a href="https://hexo.io" target="_blank" rel="noopener" class="footer-hexo-link">Hexo</a></p>
                    </div>
                    <p class="footer-quote">Life is a struggle,but you can fight against it...</p>

                </div>
            </div>
        </footer>
    </div>

    <!-- 按需加载Highlight.js JavaScript -->
    <% if (is_post() && page.content && page.content.includes('<code')) { %>
        <script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
        <script>
            // 延迟加载highlight.js以提高性能
            function loadHighlight() {
                if (typeof hljs !== 'undefined') {
                    hljs.highlightAll();
                } else {
                    // 如果hljs还未加载，等待一段时间后重试
                    setTimeout(loadHighlight, 100);
                }
            }
            
            document.addEventListener('DOMContentLoaded', loadHighlight);
            
            // 如果DOM已经加载完成，立即执行
            if (document.readyState !== 'loading') {
                loadHighlight();
            }
        </script>
    <% } %>
    
    
    <script defer src="<%- url_for('js/search.js') %>"></script>
    <script defer src="<%- url_for('js/script.js') %>"></script>
</body>
</html>